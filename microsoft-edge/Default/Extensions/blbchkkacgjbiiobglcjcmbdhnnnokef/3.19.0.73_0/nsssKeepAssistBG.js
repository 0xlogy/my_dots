(()=>{const{uiConstants:{MESSAGES:i},telemetryWrapper:n,constants:{URL_PARAMS_KEY:S}}=NSSS,{constants:{BROWSER_TYPE:{EDGE_CHROMIUM:r}},utils:{isNil:a},localizer:o,extensionAdapter:e}=SymBfw;class _{static get SEARCH_POINTS(){return{HP:"hp",DS:"ds"}}static get SEARCH_POINT_NAMES(){return{[this.SEARCH_POINTS.HP]:"Norton Home Page",[this.SEARCH_POINTS.DS]:"Norton Safe Search"}}static get SEARCH_POINT_TO_TELEMETRY_FEATURE_MAP(){return{[this.SEARCH_POINTS.HP]:n.searchFeature.DEFAULT_HOMEPAGE,[this.SEARCH_POINTS.DS]:n.searchFeature.DEFAULT_SEARCH_PROVIDER}}}NSSS.keepAssistBG=new class{constructor(){this.handleMessage=this.handleMessage.bind(this)}_findSearchPoint(e){let t=_.SEARCH_POINTS.HP;return t=NSSS.NSSSHelper.isYahooSERPPage(e)||NSSS.NSSSHelper.isIACSERPPage(e)?_.SEARCH_POINTS.DS:t}_getKeepAssistUIStrings(e){var t=SymBfw.globals.BROWSER,S=NSSS.uiConstants.KEEP_ASSIST_UI;if(a(S))return{};const s={};s.title=o.getLocalizedString(S[t].title),s.keepText=o.getLocalizedString(S[t].keepText),s.keepButtonText=o.getLocalizedString(S[t].keepButtonText),s.done=o.getLocalizedString(S.done);var i=_.SEARCH_POINT_NAMES[e];return t===r?(t=S.descriptionTextEdge,s.descriptionText=o.getLocalizedStringWithFormat(t,[i])):({description1:t,description2:S}=S[e],t=o.getLocalizedString(t),S=o.getLocalizedStringWithFormat(S,[i]),s.descriptionText=t+" "+S),s}_shouldShowReverseImage(e,t){return e===SymBfw.constants.os.MAC?"rtl"===t:"ltr"===t}_initKeepAssistUI(e){var e=this._findSearchPoint(e),t=SymBfw.localizer.getCurrentLanguageDirection(),S=SymBfw.utils.getOSType();const s={};return s.direction=t,s.productName=NSSS.constants.PRODUCT_NAME,s.strings=this._getKeepAssistUIStrings(e),s.searchPoint=e,s.showReverseImage=this._shouldShowReverseImage(S,t),s}_isDSPage(e){if(!NSSS.NSSSHelper.isYahooSERPPage(e)&&!NSSS.NSSSHelper.isIACSERPPage(e))return!1;const t=new URL(e).searchParams;return!(!t.has(S.OCODE)||t.get(S.OCODE)!==NSSS.ocodeMgr.getDSOCode())}handleMessage(t,S,s){if(!(a(t)||a(t.name)||a(s)||a(s.url)))switch(t.name){case i.KEEP_ASSIST_UI_INIT:S(this._initKeepAssistUI(s.url));break;case i.SHOULD_SHOW_DS_KEEP_ASSIST_POPUP:if(!this._isDSPage(s.url)){S(null);break}let e=NSSS.globalSettings.getValue(NSSS.constants.IS_DSP_FIRST_LAUNCH);S({isDSPFirstLaunch:e=!!a(e)||e}),e&&NSSS.globalSettings.setValue(NSSS.constants.IS_DSP_FIRST_LAUNCH,!1);break;case i.DONE_BUTTON_CLICKED:if(!Object.values(_.SEARCH_POINTS).includes(t.searchPoint))return;n.sendKeepAssistContinueButtonClickedEvent(_.SEARCH_POINT_TO_TELEMETRY_FEATURE_MAP[t.searchPoint]);break;case i.KEEP_ASSIST_SHOWN:if(!Object.values(_.SEARCH_POINTS).includes(t.searchPoint))return;n.sendKeepAssistShownEvent(_.SEARCH_POINT_TO_TELEMETRY_FEATURE_MAP[t.searchPoint])}}},NSSS.KeepAssistConstants=_,e.addMessageListener(NSSS.keepAssistBG.handleMessage)})();