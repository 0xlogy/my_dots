var guid;!function(e){"use strict";(e.NSSS=e.NSSS||{}).searchGlobal=function(a,s){var i={},r=a.logger,o=(a.utils,s.helperUtils),n=a.utils.isNil,t=a.utils.isntNil,l=s.constants,E=s.globalSettings;a.settings;let c=a.extensionAdapter,e=s.NSSSHelper;a.utils.isString,a.constants.BROWSER_TYPE;const{constants:S,uiConstants:d,uiConstants:{MESSAGES:u}}=s;return i.settingsContainer=null,i.isWindowsOS=!1,i.IS_HP=!1,i.handleOmniSearchEvent=function(e){if(a.globals.BROWSER===a.constants.BROWSER_TYPE.FIREFOX&&!s.privacyPromptSettings.getPrivacyConsent())return t=c.getExtensionURL(s.uiConstants.PRIVACY_PROMPT_SCREEN.HTML),c.updateTabUrl(e.tabId,t),{cancel:!0};var t=e.url,e=o.getQueryString("q",t);const n=o.getSearchURLTemplate(s.ocodeMgr.getDSOCode());return{redirectUrl:n.replace("$$TEMPLATE$$",e)}},i._switchFocusToPortal=async function(){if(a.globals.BROWSER===a.constants.BROWSER_TYPE.EDGE_CHROMIUM){var e=s.constants.NORTON_SW_EXTENSION_IDS;const t=await o.getExtensionInstalledAndEnabledStatus(e);Object.keys(t).some(e=>!0===t[e])||(e=await o.getLandingPage(),n(e)||c.activateTab(e.id))}},i.handleInstall=function(e){let t=e.reason,n=(s.isFreshInstall=!1,"install"===t&&(s.isFreshInstall=!0,s.main.injectWebCommunication(),i._switchFocusToPortal()),s.init.ready());n.then(function(){let e=s.telemetryWrapper;switch(t){case"install":o.flavorizeExtension(),i.findAndStoreDateOfAssociation(),e.sendExtensionInstall(),s.globalSettings.getInstallDate(),s.uninstallSurveyHelper.initializeUninstallSurveyURL(),s.init.updateAntiTrackerStatus();break;case"update":i.findAndStoreDateOfAssociation(),e.sendExtensionUpdate(),s.NSSSHelper.isVendorMigrationDoneFFEdge()&&e.sendVendorMigrationPing(),s.globalSettings.getInstallDate(),s.uninstallSurveyHelper.initializeUninstallSurveyURL(),s.init.updateAntiTrackerStatus()}},function(e){r.error(e)})},i.handleMessage=function(e,t,n){var a=t.tab,i=e.message;switch(e.name){case"flavor-retrieved":o.setFlavor(a.url,i);break;case u.EXTN_SETTINGS_PAGE_LOADED_TELEMETRY:s.telemetryWrapper.sendSettingsPageLoadEvent();break;case u.UPDATE_EXTENSION_ICON:c.setBrowserIcon(e.options)}},i.actionCallback=async function(e){var t;await s.init.ready(),a.globals.BROWSER===a.constants.BROWSER_TYPE.FIREFOX&&!s.privacyPromptSettings.getPrivacyConsent()||(t=c.getExtensionURL(l.HOME_PAGE),t+="?"+l.LAUNCHED_ON_EXTENSION_CLICK,c.createTab(t),s.telemetryWrapper.sendActionClickEvent())},i.handleExternalMessage=function(e,t,n){e=e.name,t=t.id;if(l.NORTON_EXTENSION_IDS.includes(t))switch(e){case l.GET_INSTALL_DATE:n({doi:E.getInstallDate()});break;case l.GET_ASSOCIATION_DATE:n({doa:E.getDateOfAssociation()});break;case s.uiConstants.MESSAGES.GET_INTERNAL_IDENTIFIER:var a=s.NSSSHelper.getCurrentExtensionIdentifier();if(""===a)break;n({internalIdentifier:a})}},i._getSendersExtensionId=function(){var e=a.globals.BROWSER,t=l.PRODUCT_NAME;return n(e)||n(t)?null:l.EXTENSION_PAIR_IDS[t][e][l.VENDOR]},i._dateOfAssociationHelper=function(e){c.sendMessageExternal(e,{name:l.GET_INSTALL_DATE},e=>{let t=null;t=chrome.runtime.lastError||n(e)||n(e.doi)?(r.debug("getInstallDate - receiving end does not exists or response is null"),o.getNormalizedDateString(new Date)):e.doi;e=E.getInstallDate();E.setDateOfAssociation(e,t)})},i.findAndStoreDateOfAssociation=function(){var e=s.globalSettings.getDateOfAssociation();if(!t(e)){let t=i._getSendersExtensionId();n(t)||c.sendMessageExternal(t,{name:l.GET_ASSOCIATION_DATE},e=>{chrome.runtime.lastError||n(e)||n(e.doa)?(r.debug("getAssociationDate - receiving end does not exists or response is null"),i._dateOfAssociationHelper(t)):E.setDateOfAssociation(e.doa,e.doa)})}},i.initialize=function(){c.isManifestV3Extension()&&!1===i.IS_HP&&o.handleOmniSearch(),chrome.runtime.getPlatformInfo(function(e){"win"===e.os&&(i.isWindowsOS=!0)}),s.main.initVendorConstants(),i._canHandleTelemetryOptOut()&&s.main.handleTelemetryOptOut(),chrome.runtime.onMessage.addListener(i.handleMessage),c.addMessageExternalListener(i.handleExternalMessage),i._sendExtensionIdToSW(),c.isManifestV3Extension()||(chrome.browserAction.onClicked.addListener(i.actionCallback),s.isFreshInstall||s.init.updateAntiTrackerStatus(),!1===i.IS_HP&&chrome.webRequest.onBeforeRequest.addListener(i.handleOmniSearchEvent,{urls:[s.constants.SEARCH_URL+"?omnisearch=yes*"]},["blocking"]))},i._canHandleTelemetryOptOut=()=>a.globals.BROWSER!==a.constants.BROWSER_TYPE.FIREFOX||![d.HOMEPAGE_EXTENSION,d.DEFAULT_SEARCH_EXTENSION,d.THREE_IN_ONE].includes(d.EXTENSION_TYPE),i._sendExtensionIdToSW=function(){var e=s.NSSSHelper.getCurrentExtensionIdentifier();""!==e&&(e={name:s.uiConstants.MESSAGES.SEND_INTERNAL_IDENTIFIER,internalIdentifier:e},a.extensionAdapter.sendMessageExternal(l.NORTON_SW_EXTENSION_IDS[0],e,()=>{t(a.extensionAdapter.getLastError())&&r.debug("safeweb extension is not installed")}))},i._alarmHandler=async function(e){switch(await s.init.ready(),e){case S.ALARM_NAMES.QUICK_LINKS:s.quickLinksProvider.fetchDynamicQuickLinks();break;case S.ALARM_NAMES.TWITTER_FEEDS:s.twitterFeeds.fetchAndSaveTwitterFeeds();break;case S.ALARM_NAMES.TELEMETRY_NOTIFICATION:s.main.setTelemetryNotification();break;case S.ALARM_NAMES.FETCH_ANTI_TRACKER_STATUS:case S.ALARM_NAMES.PERIODIC_ANTI_TRACKER_SCHEDULER:s.antiTrackerStatusProvider.handleAntiTrackerScheduler(e)}},i._alarmCallback=e=>{i._alarmHandler(e.name)},i.load=async function(){c.isManifestV3Extension()&&chrome.action.onClicked.addListener(i.actionCallback),a.alarmHelper.registerAlarmListener(i._alarmCallback);try{await s.init.ready()}catch(e){r.error(e)}i.initialize()},i.loadExtension=async()=>{c.isManifestV3Extension()||await e.waitForWindowLoadEvent(),i.load()},i}(e.SymBfw,e.NSSS)}(executionContext),SymBfw.utils.isntNil(chrome.runtime.onInstalled)?chrome.runtime.onInstalled.addListener(NSSS.searchGlobal.handleInstall):(guid=NSSS.globalSettings.getValue(NSSS.constants.NSSS_INSTALLDATEKEY),SymBfw.utils.isNil(guid)&&setTimeout(function(){NSSS.searchGlobal.handleInstall({reason:"install"})},5e3)),NSSS.searchGlobal.loadExtension();